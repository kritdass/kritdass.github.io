---
import Tile from "./Tile.astro";
import { Icon } from "astro-icon/components";
import { getCollection } from "astro:content";

const reading = await getCollection("reading");
const readingString =
    reading.length > 0
        ? reading.map((book) => book.data.title).join(", ")
        : "Nothing right now";

const nowItems = [
    {
        label: "Location",
        value: "Pittsburgh, PA",
        icon: "map-pin",
    },
    {
        label: "Learning",
        value: "Rust, Lean, Astro",
        icon: "brain",
    },
    {
        label: "Reading",
        value: readingString,
        icon: "book",
    },
];
---

<Tile>
    <div
        class="text-xs flex flex-row gap-1.5 mb-2.5 text-gray-500 dark:text-gray-400"
    >
        <Icon name="tabler:clock" class="size-4" />
        <h2 class="font-bold uppercase tracking-widest">Now</h2>
        <span>&middot;</span>
        <span id="local-time" class="text-xs font-mono font-medium"></span>
    </div>

    <div
        class="grid grid-cols-1 divide-y divide-gray-400 dark:divide-gray-500 h-full min-h-35"
    >
        {
            nowItems.map((item) => (
                <div class="flex items-center gap-4">
                    <div>
                        <Icon
                            name={`tabler:${item.icon}`}
                            class="size-5 text-gray-600 dark:text-gray-400"
                        />
                    </div>
                    <div class="flex flex-col">
                        <span class="text-sm font-bold text-gray-900 dark:text-gray-100 leading-tight">
                            {item.label}
                        </span>
                        <span class="text-xs text-gray-600 dark:text-gray-400 font-mono line-clamp-1">
                            {item.value}
                        </span>
                    </div>
                </div>
            ))
        }
    </div>
</Tile>

<script is:inline>
    function updateTime() {
        const timeElement = document.getElementById("local-time");
        if (timeElement) {
            const now = new Date();
            timeElement.innerText = now.toLocaleTimeString("en-US", {
                timeZone: "America/New_York",
            });
        }
    }

    updateTime();
    setInterval(updateTime, 1000);
</script>
